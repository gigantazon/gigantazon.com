{% extends "ideas/base.html" %}
{% load static %}

{% block main %}
<script>
$(document).ready(function () {
  var loc = document.URL.indexOf('mypage')
  console.log(loc)
  if (document.URL.indexOf('mypage') != -1 ) {
    $('a[href=#mine]').tab('show') 
  } else if (document.URL.indexOf('watchpage') != -1 ) {
    $('a[href=#watch]').tab('show') 
  } else {
    $('a[href=#latest]').tab('show') 
  }
})
</script>

<div class="row">
 <div class="col-md-5 col-md-offset-1">
  <button type="button" class="btn btn-default" data-toggle="modal" data-target="#ideaModal">Add Idea</button><br />
 	<h3>Top Ideas</h3>
  <ul class="list-group">
{% for drop in drop_parents %}
	 <a href="view/{{ drop.id }}" class="default"><li class="top-ideas">{{ drop.data|title|truncatechars:100 }}</li></a>
{% endfor %}
{% if drop_parents.has_previous %} 
  <a href="?page={{ drop_parents.previous_page_number }}"><span class="label label-info">Prev</span></a>
{% endif %}
{% if drop_parents.has_next %}
  <a href="?page={{ drop_parents.next_page_number }}"><span class="label label-info">Next<span></a>
{% endif %}


  </ul>
 </div>
 <div class="col-md-5 col-md-offset-0">
  <div class="row">
    <div class="col-md-12" role="tabpanel">
      <ul class="nav nav2 nav-tabs" role="tablist">
        <li  class="active" role="presentation" ><a aria-controls="latest" data-toggle="tab"href="#latest">Latest</a></li>
        <li role="presentation" ><a aria-controls="watch" data-toggle="tab" href="#watch">Watching</a></li>
        <li role="presentation" ><a aria-controls="mine" data-toggle="tab" href="#mine">My Ideas</a></li>
      </ul>
      <div class="tab-content">
        <div role="tabpanel1" class="tab-pane active" id="latest">
          <ul class="list-unstyled">
            {% for r in latest %}
           {% if r.drop_type == 'spark' %}
             <li class="default spark"><a href="{{ r.id }}">{{ r.data|truncatechars:100}}</a></li>
            {% elif r.drop_type == 'idea' %}
    	       <li class="default idea"><a href="view/{{ r.id }}">{{ r.data|truncatechars:100 }}</a></li>
            {% elif r.drop_type == 'action' %}
    	       <li class="default action"><a href="view/{{ r.id }}">{{ r.data|truncatechars:100 }}</a></li>
            {% else %}
    	       {{ pass }}
            {% endif %}
           {% endfor %}
          </ul>
          {% if latest.has_next %}
             <a href="?latest={{ latest.next_page_number }}"><span class="label label-default">Next</span></a>
          {% endif %}
          {% if latest.has_previous %}
             <a href="?latest={{ latest.previous_page_number }}"><span class="label label-default">Prev</span></a>
          {% endif %}
        </div>
        <div role="tabpanel1" class="tab-pane" id="watch">
          {% if user.is_authenticated %}
           <ul class="list-unstyled">
           {% for w in watching %}
            {% if w.drop.drop_type == 'spark' %}
             <li class="default spark"><a href="view/{{ w.drop.id }}">{{ w.drop.data|truncatechars:100 }}</a></li>
            {% elif w.drop.drop_type == 'idea' %} 
             <li class="default idea"><a href="view/{{ w.drop.id }}">{{ w.drop.data|truncatechars:100}}</a></li>
            {% elif w.drop.drop_type == 'action' %}
             <li class="default action"><a href="view/{{ w.drop.id }}">{{ w.drop.data|truncatechars:100}}</a></li>
            {% endif %}
           {% endfor %}
          {% else %}
            You must be logged in
          {% endif %}
        </div>
        <div role="tabpanel1" class="tab-pane" id="mine">
          {% if user.is_authenticated %}
           <ul class="list-unstyled">
           {% for m in mine %}
            {% if m.drop_type == 'spark' %}
             <li class="default spark"><a href="view/{{m.id}}">{{ m.data|truncatechars:70 }}</a></li>
            {% elif m.drop_type == 'idea' %}
             <li class="default idea"><a href="view/{{m.id}}">{{ m.data|truncatechars:70 }}</a></li>
            {% elif m.drop_type == 'action' %}
             <li class="default action"><a href="view/{{m.id}}">{{ m.data|truncatechars:70 }}</a></li>
            {% endif %}
           {% endfor %}
           </ul>
           {% if mine.has_previous %}
             <a href="?mypage={{ mine.previous_page_number }}"><span class="label label-default">Prev</span></a>
           {% endif %}
           {% if mine.has_next %}
             <a href="?mypage={{ mine.next_page_number }}"><span class="label label-default">Next</span></a>
           {% endif %}

          {% else %}
            You must be logged in
          {% endif %}
        </div>          
      </div>
    </div>
  </div>
 </div>
</div>

<div class="modal fade" id="ideaModal" tabindex="-1" role="dialog" aria-labelledby="ideaModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        {% if user.is_authenticated %}
        <h4 class="modal-title" id="ideaModalLabel">Add New Idea</h4>
      </div>
      <div class="modal-body">
        <form class="form" id="add_idea" method="post" action="/ideas/">
          {% csrf_token %}
          <div class="form-group">
            <textarea maxlength="250" class="form-control" rows="3" name="data" id="textIdea" placeholder="Add your idea" style="max-width: 80%; width: 80%"> </textarea>
          </div>
          <button type="submit" class="btn btn-default">Submit</button>
        </form>
      </div>
       {% else %}
       <h4>Please Register</h4>
      </div>
      <div class="modal-body">
         <form id="user_form" method="post" action="/ideas/register/" enctype="multipart/form-data">
          {% csrf_token %}
           {% for field in user_form %}
              {{ field.errors }}
              <div class="form-group">
               <div class="md-col-2">
                {{ field.name.capitalize }}
               </div>
               <div class="md-col-4">
                {{ field }}
               </div>
              </div>
           {% endfor %}

           {% for field in profile_form %}
            {{ field.errors }}
            <div class="form-group">
             <div class="md-col-2">
              {{ field.name.capitalize }}
             </div>
             <div class="md-col-4">
              {{ field }}
             </div>
            </div>
           {% endfor %}
            <div class="form-group">
             <div class="md-col-4">
              <div class="small primary pretty button"><input type="submit" name="submit" value="Register"></a></div>
             </div>
            </div>
         </form>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
