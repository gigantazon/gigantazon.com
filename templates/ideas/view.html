{% extends "ideas/base.html" %}
{% load static %}
{% block head %}
<script>
$(document).ready(function(){
  var idea_id = {{ title.id }}
  var url = "/ideas/view/subs/"+idea_id
    $.ajax({
      type: "GET",
      url: url,
      success: function(data)
      {
        $.each(data, function(index, val) {
          var url = "/ideas/view/is_parent/"+val.id
          $.ajax({
            type: "GET",
            url: url,
            success: function(subs)
            {
              if ( subs > 0 ) {
                if ( val.drop_type === 'spark'){
                  $('ul#spark_list').append("<li id='"+val.id+"'><a href='#' class='parent'>"+val.data+"</a></li>")
                } else if ( val.drop_type === 'idea') {
                  $('ul#idea_list').append("<li id='"+val.id+"'><a href='#' class='parent'>"+val.data+"</a></li>")
                } else if ( val.drop_type === 'action') {
                  $('ul#spark_list').append("<li id='"+val.id+"'><a href='#' class='parent'>"+val.data+"</a></li>")
                }
              } else {
                if ( val.drop_type === 'spark'){
                  $('ul#spark_list').append("<li id='"+val.id+"'>"+val.data+"</li>")
                } else if ( val.drop_type === 'idea') {
                  $('ul#idea_list').append("<li id='"+val.id+"'>"+val.data+"</li>")
                } else if ( val.drop_type === 'action') {
                  $('ul#spark_list').append("<li id='"+val.id+"'>"+val.data+"</li>")
                }
              }
            }
          })

        })
      }
    })
  $( document ).on('click', 'a.parent', function(e){
    e.preventDefault;
    var idea_id = $(this).parent().prop('id');
    var url = "/ideas/view/subs/"+idea_id
    $.ajax({
      type: "GET",
      url: url,
      success: function(data)
      {
        $("div#sub1").remove();
        $('div#main').after("<div class='row' id='sub1'><div class='col-md-8 col-md-offset-3'><div class='row'>\
          <div class='col-md-4'><div class='spark alert'><center><h4>Sparks</center></h4></div><ul class='list-unstyled' id='sub_sparks'></ul></div>\
          <div class='col-md-4'><div class='idea alert'><center><h4>Ideas</center></h4></div><ul class='list-unstyled' id='sub_ideas'></ul></div>\
          <div class='col-md-4'><div class='action alert'><center><h4>Actions</center></h4></div><ul class='list-unstyled' id='sub_actions'></ul></div></div></div>")
        $.each(data, function(index, val) {
          if ( val.drop_type === 'spark') {
            $('ul#sub_sparks').append("<li id='"+val.id+"'>"+val.data+"</li>")
          } else if ( val.drop_type === 'idea' ) {
            $('ul#sub_ideas').append("<li id='"+val.id+"'>"+val.data+"</li>")
          } else if ( val.drop_type === 'action' ){
            $('ul#sub_actions').append("<li id='"+val.id+"'>"+val.data+"</li>")
          }
        })
      }
    })
  })
 });   
</script>
  <script
      type="text/javascript" i
      src="http://d3js.org/d3.v3.min.js">
  </script>
  <script
      type="text/javascript"
      src="http://d3js.org/queue.v1.min.js"> 
  </script>


{% endblock %}

{% block main %}
<div class="container-fluid">

<div class="row">
 <div class="col-md-8">
  <h2>{{ title|title }}</h2>
 </div>
</div>

<div class="row" id="main" style="margin-top: 20px;">
 <div class="col-md-3" id="svg">
 </div>

 <div class="col-md-8">

  <div class="row" style="min-height: 250px">

    <div class="col-md-4">
     <div class="spark alert"><center><h4>Sparks</h4></center></div>
     <ul id="spark_list" class="list-unstyled">

     </ul>
    </div>

    <div class="col-md-4">
     <div class="idea alert" id="title"><center><h4>Ideas</h4></center></div>
      <ul id="idea_list" class="list-unstyled">

      </ul>
    </div>

    <div class="col-md-4">
     <div class="action alert"><center><h4 class="">Actions</h4></center></div>
     <ul id="action_list" class="list-unstyled">

      </ul>
    </div>

  </div><!-- row -->
 </div><!-- column -->
</div><!-- row -->


<div class="row">
  <div class="col-md-8 col-md-offset-3">
    <div id="data">
    </div>  
  </div>
</div>

</div><!-- container -->


{% endblock %}
